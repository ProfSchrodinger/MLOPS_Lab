# MLOps Lab 4: DVC Data & Model Versioning

This project uses DVC to version-control the `cc_general.csv` dataset and two K-Means clustering models to compare their performance.

* **Model v1:** Trained on a subset of 12 features.
* **Model v2:** Trained on all available features.

The workflow is managed by DVC, with model artifacts stored in Google Cloud Storage and metrics (`metrics.json`) tracked directly by Git.

## Results & Metric Comparison

The `v1` model (12 features) performed slightly better than the `v2` model (all features).

* **Model v1 (12 features):** `silhouette_score = 0.20658`
* **Model v2 (all features):** `silhouette_score = 0.20264`

This comparison was generated by tracking `metrics.json` across commits.

### DVC Commands for Comparison

1.  **Show Terminal Diff:**
    This command compares the metrics from the previous commit (v1) with the current one (v2).
    ```bash
    dvc metrics diff HEAD~1
    ```
    **Output:**
    ```
    Path          Metric            HEAD~1   workspace   Change
    metrics.json  silhouette_score  0.20658  0.20264     -0.00394
    ```

2.  **Generate HTML Report:**
    This creates a shareable `report.html` file visualizing the comparison.
    ```bash
    dvc plots diff HEAD~1 -o report.html
    ```

## Project Workflow

### How to Run

1.  **Install Dependencies:**
    ```bash
    pip install pandas scikit-learn dvc[gs]
    ```

2.  **Pull Data:**
    This downloads `data/cc_general.csv` from the DVC remote.
    ```bash
    dvc pull
    ```

3.  **Run Training:**
    Run the script to train either model version. This generates `model/model.joblib` and `metrics.json`.
    ```bash
    # To train the 12-feature model
    python scripts/train.py --version v1
    
    # To train the all-feature model
    python scripts/train.py --version v2
    ```

### Tracking New Experiments

To save a new experiment after running `train.py`:

1.  **Track Outputs:**
    Use `dvc add` for the large model and `git add` for the small metric file.
    ```bash
    dvc add model/model.joblib
    git add model/model.joblib.dvc metrics.json dvc.yaml
    ```

2.  **Commit Experiment:**
    ```bash
    git commit -m "Train v3 model (e.g., 8 clusters)"
    ```

3.  **Push Data & Models:**
    ```bash
    dvc push
    ```

### Switching Between Model Versions

To retrieve any old model (e.g., the `v1` model):

1.  **Check out the Git commit:** (Find the hash with `git log --oneline`)
    ```bash
    git checkout <v1_commit_hash>
    ```

2.  **Check out the DVC data:**
    This reads the `.dvc` pointer file and restores the correct `model.joblib` from DVC's cache.
    ```bash
    dvc checkout
    ```